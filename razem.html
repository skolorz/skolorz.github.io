<html lang="pl-PL" xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="stylesheet" type="text/css" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css"/>

    <script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js'></script>
    <script type='text/javascript' src='http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js?2'></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        #container {
            width: 100%;
        }
        #map {
            height: 500px;
            width: 600px;
            background-color: #fff;
            float: left
        }
        #info {
            padding-top: 100px;
        }
        #ctrl{
        }
        div.form-container{
            float: left;
            margin: 10px;
        }
    </style>
</head>

<body>

<div id="container" class="content-wrap">
    <div id="map"></div>
    <div id="info" class=""></div>
    <div id="powiat" class=""></div>
    <hr style="width: 100%"/>
    <div id="ctrl">
        <form id="template" >
            <div class="form-container">
                <p>
                <h2></h2>
                <div class="opacity">
                    <label>nieprzezroczystość</label>
                    </br>
                    <input type="range" min="0" max="10" value="0" class="slider"/>
                </div>
                <div class="weight">
                    <label>waga</label>
                    </br>
                    <input type="range" min="1" max="10" value="0" class="slider"/>
                </div>
                </p>
            </div>
        </form>
    </div>
</div>

<script>
var styles = {}; 
    styles["polska"] = {
    "color": "#777777",
    "weight": 3,
    "opacity": 1,
    "fillOpacity": 0
    },
    styles["wojewodztwa"] = {
    "color": "#999999",
    "weight": 2,
    "opacity": 0.8,
    "fillOpacity": 0
    },
    styles["powiaty"] = {
    "color": "#999999",
    "weight": 1,
    "opacity": 0.6,
    "fillOpacity": 0
    },
    styles["razem"] = {
    "color": "#500030",
    "weight": 2,
    "opacity": 0.4,
    "fillOpacity": 0
    },
    razemHoverStyle = {};
    Object.assign(razemHoverStyle, styles["razem"]);
    razemHoverStyle .fillOpacity = 0.4;

    var layers = {},
        map = L.map('map', {
        center: [52.093, 19.577],
        minZoom: 6,
        maxZoom: 16,
        zoom: 6,
        dragging: false,
        touchZoom: false,
        zoomControl: false
    });

    function resetHighlight(config) {
        return function (e) {
            layers[config.layer].resetStyle(e.target);
            $(config.el).empty();
        }
    }

	function highlightFeature(config) {
        return function (e) {
            var target = e.target;
            config.style &&  target.setStyle(config.style);
            $(config.el).html(config.prefix + target.feature.properties[config.data] + config.suffix);
        }
	}

    function defineHover(config) {
        return function onEachFeature(feature, layer) {
            layer.on({
                    mouseover: highlightFeature(config),
                    mouseout: resetHighlight(config)
           });
        }
    }

function addLayer(json, style, onEachFeature) {
      return L.geoJson(json, {
                  style: style,
                  onEachFeature: onEachFeature 
      }).addTo(map);
}

$.when(
        $.getJSON("polska.json"),
        $.getJSON("wojewodztwa.json"),
        $.getJSON("powiaty.json"),
        $.getJSON("razem.json")
        )
    .then(function(polskaJson, wojewodztwaJson, powiatyJson, razemJson) {
        var razemHover; 

        razemHover = defineHover({
                      el: "#info", 
                      prefix: "<h3> Okręg ",
                      suffix: "<h3>",
                      data: "name",
                      layer: "razem",
                      style: razemHoverStyle
                  }),

        layers["powiaty"] = addLayer(powiatyJson, styles["powiaty"] );
        layers["wojewodztwa"] = addLayer(wojewodztwaJson, styles["wojewodztwa"] );
        layers["polska"] = addLayer(polskaJson, styles["polska"] );
        layers["razem"] = addLayer(razemJson, styles["razem"] , razemHover);
})
.then(function () {
    function attachCtrls(id){
        var form, opacity, opacityLbl,weight, weightLbl, 
            layer = layers[id],
            style = styles[id];

        form = $("#template").clone(true, true);
        form.attr("id", id);
        form.appendTo("#ctrl");
        form = $("#"+id);
        form.attr("display", "block");
        form.find("h2")[0].innerText = id;

        opacity = form.find("div.opacity input");
        opacity.attr("id", id + "-opacity");
        opacityLbl = form.find("div.opacity label")[0];
        opacity.val(style.opacity * 10);
        opacityLbl.innerText = "nieprzezroczystość: " + style.opacity;
        opacity.on("input", e => { 
            style.opacity = opacity.val()/10; 
            layer.setStyle(style);
            opacityLbl.innerText = "nieprzezroczystość: " + style.opacity;
        });

        weight = form.find("div.weight input");
        weightLbl = form.find("div.weight label")[0];
        weight.val(style.weight * 2);
        weightLbl.innerText = "waga: " + style.weight;
        weight.on("input", e => { 
            style.weight = weight.val() / 2; 
            layer.setStyle(style);
            weightLbl.innerText = "waga: " + style.weight;
        });

    }

    attachCtrls("polska");
    attachCtrls("wojewodztwa");
    attachCtrls("powiaty");
    attachCtrls("razem");
    $("#template").hide();
});


</script>
</body>
</html>
